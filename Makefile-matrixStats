
SRC := src/hyperSpec.matrixStats/R/*.R #src/hyperSpec.matrixStats/NAMESPACE 
MAN := src/hyperSpec.matrixStats/man/*.Rd
RNW := src/hyperSpec.matrixStats/inst/doc/*.Rnw


all: roxy build check test

.FORCE: # always done, like .PHONY, but doesn't remove file


www/hyperSpec.matrixStats-prebuilt.zip: # built manually 
	touch $@

#####################################################################################################

DESCRIPTION: $(shell find src/hyperSpec.matrixStats -maxdepth 1 -daystart -not -ctime 0 -name "DESCRIPTION") #only if not modified today
	@echo update DESCRIPTION
	sed "s/\(^Version: .*-\)20[0-9][0-9][0-1][0-9][0-3][0-9]\(.*\)$$/\1`date +%Y%m%d`\2/" src/hyperSpec.matrixStats/DESCRIPTION > .DESCRIPTION
	sed "s/\(^Date: .*\)20[0-9][0-9]-[0-1][0-9]-[0-3][0-9]\(.*\)$$/\1`date +%F`\2/" .DESCRIPTION > src/hyperSpec.matrixStats/DESCRIPTION 
	rm .DESCRIPTION

roxy: clean DESCRIPTION src/hyperSpec.matrixStats/R/*.R 
	rsync -av --delete src/hyperSpec.matrixStats/ pkg/hyperSpec.matrixStats/
	Rscript --vanilla -e "library (roxygen2); roxygenize ('pkg/hyperSpec.matrixStats')" 

build: roxy
	rm -f hyperSpec.matrixStats_*.tar.gz
	R CMD build pkg/hyperSpec.matrixStats  && cp hyperSpec.matrixStats_*.tar.gz www/hyperSpec.matrixStats-prebuilt.tar.gz

check: build
	R CMD check hyperSpec.matrixStats_*.tar.gz

devcheck: devbuild
	~/r-devel/bin/R CMD check hyperSpec.matrixStats_*.tar.gz

checkfast: $(SRC)
	R CMD check --no-examples --no-tests --no-manual --no-vignettes pkg/hyperSpec.matrixStats

checktest: $(SRC)
	R CMD check --no-manual --no-vignettes pkg/hyperSpec.matrixStats

clean: .FORCE

install:
		sudo R CMD INSTALL pkg/hyperSpec.matrixStats	


SRC := src/hyperSpec.sim/R/*.R #src/hyperSpec.sim/NAMESPACE 
MAN := src/hyperSpec.sim/man/*.Rd
RNW := src/hyperSpec.sim/inst/doc/*.Rnw


all: roxy build check install

.FORCE: # always done, like .PHONY, but doesn't remove file


www/hyperSpec.sim-prebuilt.zip: # built manually 
	touch $@

#####################################################################################################

DESCRIPTION: $(shell find src/hyperSpec.sim -maxdepth 1 -daystart -not -ctime 0 -name "DESCRIPTION") #only if not modified today
	@echo update DESCRIPTION
	sed "s/\(^Version: .*-\)20[0-9][0-9][0-1][0-9][0-3][0-9]\(.*\)$$/\1`date +%Y%m%d`\2/" pkg/hyperSpec.sim/DESCRIPTION > .DESCRIPTION
	sed "s/\(^Date: .*\)20[0-9][0-9]-[0-1][0-9]-[0-3][0-9]\(.*\)$$/\1`date +%F`\2/" .DESCRIPTION > pkg/hyperSpec.sim/DESCRIPTION 
	rm .DESCRIPTION

roxy: clean DESCRIPTION pkg/hyperSpec.sim/R/*.R 
	Rscript --vanilla -e "library (roxygen2); roxygenize ('pkg/hyperSpec.sim')" 

build: roxy
	rm -f hyperSpec.sim_*.tar.gz
	R CMD build pkg/hyperSpec.sim  && cp hyperSpec.sim_*.tar.gz www/hyperSpec.sim-prebuilt.tar.gz

check: build
	R CMD check hyperSpec.sim_*.tar.gz

devcheck: devbuild
	~/r-devel/bin/R CMD check hyperSpec.sim_*.tar.gz

checkfast: $(SRC)
	R CMD check --no-examples --no-tests --no-manual --no-vignettes pkg/hyperSpec.sim

checktest: $(SRC)
	R CMD check --no-manual --no-vignettes pkg/hyperSpec.sim

clean: .FORCE

install:
		sudo R CMD INSTALL pkg/hyperSpec.sim	
